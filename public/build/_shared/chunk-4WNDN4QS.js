var a=class extends Error{};a.prototype.name="InvalidTokenError";function d(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,r)=>{let t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function p(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return d(e)}catch{return atob(e)}}function c(o,e){if(typeof o!="string")throw new a("Invalid token specified: must be a string");e||(e={});let r=e.header===!0?0:1,t=o.split(".")[r];if(typeof t!="string")throw new a(`Invalid token specified: missing part #${r+1}`);let n;try{n=p(t)}catch(i){throw new a(`Invalid token specified: invalid base64 for part #${r+1} (${i.message})`)}try{return JSON.parse(n)}catch(i){throw new a(`Invalid token specified: invalid json for part #${r+1} (${i.message})`)}}var s=import.meta.env.VITE_API_URL;console.log("API_URL:",s);async function w(o,e){try{let r=await fetch(`${s}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:o,contrasena:e})}),t=await r.json();if(!r.ok)throw new Error(t.message||"Error al iniciar sesi\xF3n");localStorage.setItem("token",t.token);let n=c(t.token);return localStorage.setItem("rol",n.Rol),{token:t.token,rol:n.Rol}}catch(r){throw new Error(r.message)}}async function h(o){try{let e=await fetch(`${s}/api/password/forgot`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:o}),mode:"cors"}),r=await e.json();if(!e.ok)throw new Error(r.message||"Error al enviar la solicitud de recuperaci\xF3n");return r}catch(e){throw new Error(e.message)}}async function f(o,e,r){try{let t=await fetch(`${s}/api/password/reset`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({TokenRecuperacion:o,NuevaContrasena:e,ConfirmarContrasena:r}),mode:"cors"}),n=await t.json();if(!t.ok)throw new Error(n.message||"Error al restablecer la contrase\xF1a");return n}catch(t){throw new Error(t.message)}}export{w as a,h as b,f as c};
